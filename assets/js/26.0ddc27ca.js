(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{55:function(t,n,s){"use strict";s.r(n);var a=s(0),e=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"dom-中的-selection-range-对象使用总结（光标定位控制）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dom-中的-selection-range-对象使用总结（光标定位控制）","aria-hidden":"true"}},[t._v("#")]),t._v(" DOM 中的 Selection & Range 对象使用总结（光标定位控制）")]),s("p",[t._v('项目中使用 div + contenteditable="true" 模拟输入框时，遇到一个问题：'),s("br"),t._v("\n当 div 中有文本内容，通过 js 代码将焦点聚焦到该 div 时，光标总是定位在文本内容前面。"),s("br"),t._v("\n想要的效果是，光标定位在文本内容后面，为了解决该问题做了一些探索，记录一下。"),s("br"),t._v("\n（网上搜索到的别人的很多方法，发现很多都是浏览器不支持的，MDN 中也查不到，不知道是不是被废弃了）")]),s("p",[t._v("首先我们要知道一点："),s("strong",[t._v("光标位置是由 Selection 对象控制的")]),t._v("。"),s("br"),s("em",[t._v("如果 Selection 对象的起始点和终止点重合，则显示效果为一个闪烁的光标，否则显示效果是一段高亮的区域。")])]),s("p",[t._v("直接上一段有效的 code：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// demo1")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" range "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("createRange")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 创建一个范围，IE可能需要使用createTextRange及其对应方法，此处只记录标准方法")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" node "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'xxx'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childNodes"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// childNodes[0]通常为文本节点")]),t._v("\nrange"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("selectNodeContents")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \b"),s("span",{attrs:{class:"token comment"}},[t._v("// 将文本节点的内容添加到范围(Range)中")]),t._v("\nrange"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("collapse")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token boolean"}},[t._v("false")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 清除范围中包含的内容，并把\b\b范围的\b起始点设置为\b原\b内容\b的结尾")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" selection "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getSelection")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 获取当前的\b\b选区(Selection)，即焦点聚焦的元素")]),t._v("\nselection"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("removeAllRanges")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 删除选区中原有的所有范围，通常一个选区中只有一个范围")]),t._v("\nselection"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("addRange")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("range"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 将新创建的范围添加到选区中")]),t._v("\n")])]),s("p",[t._v("以上代码就是设置光标到文本内容末尾的一种方式。"),s("br"),t._v("\n其实该代码部分内容稍微修改下也可以达到同样效果：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// demo2")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" range "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("createRange")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 创建一个范围，IE可能需要使用createTextRange及其对应方法，此处只记录标准方法")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" node "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'xxx'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childNodes"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// childNodes[0]通常为文本节点")]),t._v("\nrange"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("selectNodeContents")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \b"),s("span",{attrs:{class:"token comment"}},[t._v("// 将文本节点的内容添加到范围(Range)中")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// range.collapse(false) // 清除范围中包含的内容，并把\b\b范围的\b起始点设置为\b原\b内容\b的结尾")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" selection "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("getSelection")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 获取当前的\b\b选区(Selection)，即焦点聚焦的元素")]),t._v("\nselection"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("removeAllRanges")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 删除选区中原有的所有范围，通常一个选区中只有一个范围")]),t._v("\nselection"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("addRange")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("range"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 将新创建的范围添加到选区中")]),t._v("\nselection"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("collapseToEnd")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 清除选区中的内容，并把选区的起始点设置为原内容的结尾")]),t._v("\n")])]),s("p",[t._v("上述代码和之前代码看起来区别不大，但其实原理不同。")]),s("ul",[s("li",[t._v("demo1 中是使用 Range 对象的 collapse 方法来实现光标的定位，此时 Range 对象中就已经不包含文本内容了，使用 Range.toString() 方法可以发现内容为空，并且 Range 对象的起始点和终止点位置都是在文本内容末尾，所以将该 Range 对象添加到 Selection 对象中时，Selection 对象中包含的是一个没有内容的 Range 对象。由于 Selection 对象中只包含一个 Range 对象，所以 Selection 对象的起始点和终止点分别为 Range 对象的起始点和终止点，也就是文本内容的末尾。")]),s("li",[t._v("demo2 中是使用 Selection 对象的 collapseToEnd 方法来实现光标的定位，此时 Range 对象中其实是有文本内容的，Range 对象的起始点在文本内容的开头，终止点在文本内容的末尾，所以将该 Range 对象添加到 Selection 对象中时，Selection 对象的起始点和终止点也分别位于文本内容的开头和末尾。如果此时不调用 Selection.collapseToEnd() 方法，我们会发现显示效果为文本内容的全选高亮效果(就和我们自己选中一段文字的效果一样)，调用 Selection.collapseToEnd() 方法会使 Selection 对象的起始点折叠到终止点的位置，起始点和终止点重合，所以会变成光标闪烁的效果，但此时 Range 对象的起始点和终止点不会改变。")])]),s("p",[t._v("测试发现：")]),s("ul",[s("li",[t._v("safari 和 chrome 中，一个 Selection 对象中貌似只能包含一个 Range 对象，如果 Selection 对象中已经包含了一个 Range 对象，后续添加的 Range 对象无效。\n"),s("ul",[s("li",[t._v("如依次执行 selection.addRange(range1) 和 selection.addRange(range2)，selection 中只会包含 range1。")])])]),s("li",[t._v("firefox 中，一个 Selection 对象中可以包含多个 Range 对象，但 Selection 对象的起始点(anchorOffset)和终止点(focusOffset)貌似不是包含所有 Range 对象的值，而是设置为最后一个添加的 Range 对象的起始点和终止点。")])]),s("h2",{attrs:{id:"selection-对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#selection-对象","aria-hidden":"true"}},[t._v("#")]),t._v(" Selection 对象")]),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Selection",target:"_blank",rel:"noopener noreferrer"}},[t._v("Selection - MDN")])]),s("h2",{attrs:{id:"range-对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#range-对象","aria-hidden":"true"}},[t._v("#")]),t._v(" Range 对象")]),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Range",target:"_blank",rel:"noopener noreferrer"}},[t._v("Range - MDN")])])])}],!1,null,null,null);n.default=e.exports}}]);