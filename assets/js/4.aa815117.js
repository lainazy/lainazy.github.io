(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{76:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"travis-ci-使用摘要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#travis-ci-使用摘要","aria-hidden":"true"}},[t._v("#")]),t._v(" Travis CI 使用摘要")]),a("blockquote",[a("p",[t._v("Travis CI 只支持 Github，不支持其他代码托管服务。")])]),a("p",[t._v("travis 生命周期函数：")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("1. before_install "),a("span",{attrs:{class:"token comment"}},[t._v("# install阶段之前执行")]),t._v("\n2. "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("# install阶段执行")]),t._v("\n3. before_script "),a("span",{attrs:{class:"token comment"}},[t._v("# script阶段之前执行")]),t._v("\n4. script "),a("span",{attrs:{class:"token comment"}},[t._v("# script阶段执行")]),t._v("\n5. after_success or after_failure "),a("span",{attrs:{class:"token comment"}},[t._v("# script阶段成功或失败时执行")]),t._v("\n6. "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONAL"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" before_deploy "),a("span",{attrs:{class:"token comment"}},[t._v("# 部署\b之前执行")]),t._v("\n7. "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONAL"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" deploy "),a("span",{attrs:{class:"token comment"}},[t._v("# 部署时执行")]),t._v("\n8. "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONAL"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" after_deploy "),a("span",{attrs:{class:"token comment"}},[t._v("# 部署之后执行")]),t._v("\n9. after_script "),a("span",{attrs:{class:"token comment"}},[t._v("# script阶段之后执行")]),t._v("\n")])]),a("h2",{attrs:{id:"travis-使用关键步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#travis-使用关键步骤","aria-hidden":"true"}},[t._v("#")]),t._v(" travis 使用关键步骤")]),a("ol",[a("li",[a("p",[t._v("访问 "),a("a",{attrs:{href:"https://travis-ci.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("travis 官方网站")]),t._v("，使用 github 账号登录，开启账号下想要使用 travis 的仓库开关。")])]),a("li",[a("p",[t._v("在项目根目录下添加如下格式的 .travis.yml 配置文件，travis 需要根据该文件执行构建操作。")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("language")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node_js "),a("span",{attrs:{class:"token comment"}},[t._v("# 运行环境")]),t._v("\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("node_js")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" '8' "),a("span",{attrs:{class:"token comment"}},[t._v("# node.js版本号")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# cache:")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("#   yarn: true # 缓存yarn")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("#   directories:")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("#     - node_modules # 缓存node_modules目录")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("# env:")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("#   - key=value # 环境变量，可以在脚本内部使用")]),t._v("\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("install")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean important"}},[t._v("true ")]),a("span",{attrs:{class:"token comment"}},[t._v("# true表示跳过install阶段")]),t._v("\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean important"}},[t._v("true ")]),a("span",{attrs:{class:"token comment"}},[t._v("# true表示跳过script阶段")]),t._v("\n")])])]),a("li",[a("p",[t._v("修改 .travis.yml 文件中，install 和 script 阶段要执行的操作。")])]),a("li",[a("p",[t._v("push\b .travis.yml 文件到 github，travis 会自动开始构建。通常此时构建会报错，根据错误信息修改 .travis.yml 文件。错误信息中有一条是因为访问权限问题导致的自动部署失败，通常需要加密私钥。")])]),a("li",[a("p",[t._v("加密私钥需要使用 travis 的加密功能，所以先安装 ruby 的包 travis")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("gem "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v(" travis\n")])]),a("p",[t._v("使用 travis 加密文件的功能：")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("travis encrypt-file ~/.ssh/id_rsa --add "),a("span",{attrs:{class:"token comment"}},[t._v("# 加密私钥文件")]),t._v("\n")])]),a("p",[t._v("执行之后 .travis.yml 文件中会多出以下几行，同时项目中会多出一个 id_rsa.enc 文件：")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("before_install")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" openssl aes"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("256"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cbc "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("K $encrypted_d89376f3278d_key "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("iv $encrypted_d89376f3278d_iv "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("in id_rsa.enc "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("out ~/.ssh/id_rsa "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d\n")])]),a("p",[t._v("为保证权限正常，多加一行设置权限的 shell：")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("before_install")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" openssl aes"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("256"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cbc "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("K $encrypted_d89376f3278d_key "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("iv $encrypted_d89376f3278d_iv "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("in id_rsa.enc "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("out ~/.ssh/id_rsa "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" chmod 600 ~/.ssh/id_rsa\n")])])]),a("li",[a("p",[t._v("再 push 一下代码，应该就能正常部署了。")])])]),a("hr"),a("ul",[a("li",[a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("持续集成服务 Travis CI 教程 - 阮一峰")])]),a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000011218410",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis CI 系列：自动化部署博客 - segmentfault")])])])])}],!1,null,null,null);s.default=e.exports}}]);